# Документ-анализатор

Этот проект представляет собой веб-приложение на Node.js для загрузки документов любых форматов, их распознавания (OCR), извлечения текста и анализа содержимого с помощью локально установленной LLM (Ollama).

## Основные возможности

Загрузка файлов через веб-интерфейс (PDF, DOCX, изображения и др.).

OCR для PDF и изображений с помощью Tesseract (поддержка eng+rus).

Извлечение текста из офисных форматов с помощью office-text-extractor.

Анализ текста и определение типа документа (report, invoice, presentation или новый тип) через Ollama.

Генерация краткого саммари (1 абзац).

Отображение прогресса обработки (шаги + время каждого шага) через WebSocket.

## Структура проекта
```
project-root/
├── app.js               # Основной сервер Node.js (Express + WS)
├── public/
│   └── index.html       # Веб-интерфейс для загрузки файлов
├── uploads/             # Хранилище загруженных файлов и временных данных OCR
├── types.json           # Список известных типов документов
├── package.json         # Конфигурация npm
└── README.md            # Документация проекта
```

## Основной стек

* Node.js + Express — backend API и обработка файлов.
* WebSocket (ws) — трансляция статусов шагов OCR/LLM в реальном времени.
* Tesseract OCR + Poppler (pdftoppm) — распознавание PDF и изображений.
* office-text-extractor — извлечение текста из офисных форматов (DOCX, PPTX и т.п.).
* Ollama — локальный LLM для анализа текста и генерации описаний.

## Логика работы

### Воркфлоу при загрузке файла:
1. Пользователь выбирает файл и модель (UI public/index.html).
1. Файл отправляется на /upload (через fetch + FormData).
1. Сервер (app.js):
   1. Сохраняет файл в директории uploads/.
   1. Определяет тип файла (PDF, изображение или офисный формат).
   1. Для PDF/изображений выполняется:
      1. Конвертация PDF в изображения (pdftoppm).
      1. OCR с помощью tesseract (eng+rus, кодировка UTF-8).
   1. Для офисных файлов — office-text-extractor.
   1. WebSocket (/ocr-progress) сообщает в UI шаги обработки (Для каждого шага показывается время выполнения (в секундах с точностью до сотых):
      1. Загрузка.
      1. OCR (или извлечение текста).
      1. Вызов LLM.
      1. Завершение анализа.
    1. LLM (Ollama):
       1. Получает текст и список известных типов из types.json.
       1. Определяет тип документа (или предлагает новый).
       1. Создаёт краткое саммари (1 абзац).
1. UI отображает результат: тип, описание (или новый тип), саммари.

## WebSocket

Адрес: /ocr-progress.

Каждое сообщение имеет формат:
```
{
  "step": "ocr",
  "message": "Tesseract OCR для page_01.png...",
  "elapsed": "0.25"
}
```
Поле elapsed — время, затраченное на предыдущий шаг, в секундах.

## Установка и запуск

### 1. Зависимости
```
Node.js >= 18
Ollama (с установленными моделями, например gemma3n:e4b-it-fp16)
Tesseract OCR:
brew install tesseract
brew install poppler
brew install tesseract-lang
```
Проверить:
```
tesseract --list-langs | grep rus
``

### 2. Установка проекта
```
npm install
```
### 3. Запуск
```
node app.js
```
После запуска сервер доступен по адресу:
http://localhost:3000


## Фронтенд

Веб-интерфейс находится в public/index.html.

### Функции:

1. Выбор модели из списка /models.
1. Загрузка документа.
1. Отображение реального времени шагов с их длительностью.
1. Показ результата анализа.
